# データベース更新手順

0. 初期セットアップ（初回または環境再設定時のみ）
   - プロジェクトディレクトリに移動
   - OpenAI APIキーを環境変数に設定:
     ```
     export OPENAI_API_KEY='配ったものに書き換えてください'
     ```
   - 依存関係のインストールと仮想環境の作成:
     ```
     poetry install
     ```
   - Poetry シェルを起動して仮想環境に入る:
     ```
     poetry shell
     ```

1. Excelファイルの準備
   - 'text.xlsx' というファイル名で新しいExcelファイルを作成または既存のファイルを更新
   - ファイル内に 'text' という列を含める
   - 'text' 列に新しいドキュメントや更新したいテキストを入力

2. 既存のデータベースの削除
   - エクセルファイルを更新した場合、必ず既存の 'text.db' ファイルを削除してください
   - コマンドラインで以下を実行:
     ```
     rm text.db
     ```
   - または、ファイルエクスプローラーから 'text.db' ファイルを手動で削除

3. `excel_to_sqlite.py` スクリプトの実行
   - コマンドラインで以下を実行:
     ```
     python excel_to_sqlite.py
     ```
   - このスクリプトは以下の処理を行います:
     - Excelファイルを読み込む
     - 各テキストをOpenAIのAPIを使用してベクトル化
     - ベクトル化したデータを新しい `text.db` SQLiteデータベースに保存

4. アプリケーションの起動
   - コマンドラインで以下を実行してStreamlitアプリケーションを起動:
     ```
     streamlit run chat.py
     ```
   - これにより、新しいデータベースを使用したチャットボットアプリケーションが起動します
   - 起動後、ターミナルに以下のような情報が表示されます:
     ```
     Collecting usage statistics. To deactivate, set browser.gatherUsageStats to false.
     You can now view your Streamlit app in your browser.
     Local URL: http://localhost:8501
     Network URL: http://10.0.0.180:8501
     External URL: http://43.207.4.228:8501
     ```
   - External URL（例: http://43.207.4.228:8501）をクリックまたはブラウザにコピー＆ペーストして、アプリケーションにアクセスします

5. テスト
   - 起動したアプリケーションで、新しく追加したデータに関連する質問をして、正しく回答が得られることを確認

注意事項:
- OpenAI APIキーが正しく設定されていることを確認してください。セッションを閉じると環境変数がリセットされるため、新しいセッションを開始するたびにAPIキーを再設定する必要があります
- 大量のデータを一度に処理する場合は、APIの利用制限に注意してください
- データベースの更新前に重要なデータのバックアップを取ることをお勧めします
- エクセルファイルの更新と 'text.db' の削除を忘れると、古いデータと新しいデータが混在する可能性があります
- 仮想環境を終了するには、`exit` コマンドを使用してください
- 次回以降は、`poetry shell` コマンドで仮想環境に入ってから作業を開始してください
- External URLは環境によって異なる場合があります。表示されたURLを使用してください