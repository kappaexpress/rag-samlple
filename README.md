# データベース更新手順

0. 初期セットアップ（初回または環境再設定時のみ）
   - プロジェクトディレクトリに移動
   - 依存関係のインストールと仮想環境の作成:
     ```bash
     poetry install
     ```
   - Poetry ターミナルを起動して仮想環境に入る:
     ```bash
     poetry shell
     ```
   - OpenAI APIキーを環境変数に設定:
     ```bash
     export OPENAI_API_KEY='配ったものに書き換えてください'
     ```

1. Excelファイルの準備
   - 'text.xlsx' というファイル名で新しいExcelファイルを作成または既存のファイルを更新
   - ファイル内に 'text' という列を含める
   - 'text' 列に新しいドキュメントや更新したいテキストを入力

2. 既存のデータベースの削除
   - エクセルファイルを更新した場合、必ず既存の 'text.db' ファイルを削除してください
   - ファイルエクスプローラーから 'text.db' ファイルを手動で削除

3. `excel_to_sqlite.py` スクリプトの実行
   - ターミナルで以下を実行:
     ```bash
     python excel_to_sqlite.py
     ```
   - このスクリプトは以下の処理を行います:
     - Excelファイルを読み込む
     - 各テキストをOpenAIのAPIを使用してベクトル化
     - ベクトル化したデータを新しい `text.db` SQLiteデータベースに保存

4. アプリケーションの起動
   - ターミナルで以下を実行してStreamlitアプリケーションを起動:
     ```bash
     streamlit run chat.py
     ```
   - これにより、新しいデータベースを使用したチャットボットアプリケーションが起動します
   - 起動後、ターミナルに以下のような情報が表示されます:
     ```
     Collecting usage statistics. To deactivate, set browser.gatherUsageStats to false.
     You can now view your Streamlit app in your browser.
     Local URL: http://localhost:8501
     Network URL: http://10.0.0.180:8501
     External URL: http://43.207.4.228:8501
     ```
   - External URLをクリックまたはブラウザにコピー＆ペーストして、アプリケーションにアクセスします

5. テスト
   - 起動したアプリケーションで、新しく追加したデータに関連する質問をして、正しく回答が得られることを確認

注意事項:
- OpenAI APIキーが正しく設定されていることを確認してください。セッションを閉じると環境変数がリセットされるため、新しいセッションを開始するたびにAPIキーを再設定する必要があります
- 大量のデータを一度に処理する場合は、APIの利用制限に注意してください
- データベースの更新前に重要なデータのバックアップを取ることをお勧めします
- エクセルファイルの更新と 'text.db' の削除を忘れると、古いデータと新しいデータが混在する可能性があります
- 仮想環境を終了するには、`exit` コマンドを使用してください
- 次回以降は、`poetry shell` コマンドで仮想環境に入ってから作業を開始してください
- External URLは環境によって異なる場合があります。表示されたURLを使用してください

# chatアプリのプロンプト書き換えガイド

chatアプリのプロンプトを書き換えることで、AIアシスタントの応答をカスタマイズできます。以下は、`chat.py`ファイル内のプロンプトを書き換える手順です。

## 1. `chat.py`ファイルを開く

プロジェクトディレクトリ内の`chat.py`ファイルをテキストエディタで開きます。

## 2. `generate_response`関数を見つける

ファイル内で`generate_response`関数を探します。この関数内にプロンプトが定義されています。

## 3. プロンプトを修正する

現在のプロンプトは以下のようになっています：

```python
prompt = f"""以下の情報を参考にして、質問に答えてください。情報:{context}質問: {query}回答:"""
```

このプロンプトを必要に応じて修正します。例えば：

```python
prompt = f"""以下の文脈を参考に、ニュースキャスターのように質問に答えてください。文脈: {context}質問: {query}回答:"""
```

## 4. プロンプト構造を維持する

プロンプトを変更する際は、以下の要素を必ず含めるようにしてください：
- `{context}`: 検索結果から得られた関連情報
- `{query}`: ユーザーの質問

## 5. 変更を保存する

プロンプトの修正が完了したら、ファイルを保存します。

## 6. アプリケーションを再起動する

変更を反映させるため、Streamlitアプリケーションを再起動します：

```bash
streamlit run chat.py
```

## 注意事項

- プロンプトの変更は、AIアシスタントの応答スタイルや内容に大きな影響を与える可能性があります。
- 適切なプロンプトを作成するには、試行錯誤が必要な場合があります。
- セキュリティとプライバシーを考慮し、機密情報や個人情報をプロンプトに含めないよう注意してください。
